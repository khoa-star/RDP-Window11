name: ğŸš€ SEVER AI STV PREMIUM

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h'
        - '5h40m'

jobs:
  Premium-RDP-Setup:
    runs-on: windows-2022
    timeout-minutes: 340

    steps:
      - name: ğŸ¯ KHá»I Äá»˜NG Há»† THá»NG
        run: |
          Write-Host ""
          Write-Host ""
          Write-Host "ğŸ¤– AI STV PREMIUM RDP SERVER" -ForegroundColor Yellow
          Write-Host "âš¡ Powered by AI STV" -ForegroundColor Green
          Write-Host "ğŸ•’ Thá»i gian: ${{ github.event.inputs.duration }}" -ForegroundColor Magenta
          Write-Host ""

          $frames = @('â£¾','â£½','â£»','â¢¿','â¡¿','â£Ÿ','â£¯','â£·')
          for($i=0; $i -lt 10; $i++){
            Write-Host "`rğŸš€ Äang khá»Ÿi táº¡o há»‡ thá»‘ng... $($frames[$i % 8])" -NoNewline -ForegroundColor Blue
            Start-Sleep -Milliseconds 100
          }
          Write-Host "`râœ… Há»‡ thá»‘ng Ä‘Ã£ sáºµn sÃ ng!                    " -ForegroundColor Green

      - name: ğŸ”§ Cáº¤U HÃŒNH Há»† THá»NG
        run: |
          Write-Host ""
          Write-Host "ğŸ› ï¸  ÄANG Cáº¤U HÃŒNH Há»† THá»NG" -ForegroundColor Yellow

          $steps = @(
            { Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force },
            { Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force },
            { Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force },
            { netsh advfirewall firewall add rule name="RDP-Premium-In" dir=in action=allow protocol=TCP localport=3389 profile=any },
            { netsh advfirewall firewall add rule name="RDP-Premium-Out" dir=out action=allow protocol=TCP localport=3389 profile=any },
            { Set-Service -Name TermService -StartupType Automatic -ErrorAction SilentlyContinue },
            { Set-Service -Name UmRdpService -StartupType Automatic -ErrorAction SilentlyContinue },
            { Start-Service -Name TermService -ErrorAction SilentlyContinue },
            { Start-Service -Name UmRdpService -ErrorAction SilentlyContinue }
          )

          foreach($s in $steps){
            try { & $s } catch {}
          }

          Write-Host "ğŸ¯ Cáº¥u hÃ¬nh hoÃ n táº¥t!" -ForegroundColor Green

      - name: ğŸ‘¤ Táº O TÃ€I KHOáº¢N PREMIUM
        run: |
          Write-Host ""
          Write-Host "ğŸ‘¤ ÄANG Táº O TÃ€I KHOáº¢N PREMIUM" -ForegroundColor Yellow

          $Username = "Premium"
          $Password = "AnhKhoa"

          $user = Get-LocalUser -Name $Username -ErrorAction SilentlyContinue
          if (-not $user) {
            net user $Username $Password /add
            net localgroup administrators $Username /add
          } else {
            net user $Username $Password
          }

          net localgroup "Remote Desktop Users" $Username /add | Out-Null

          Write-Host ""
          Write-Host "ğŸ” THÃ”NG TIN RDP" -ForegroundColor Magenta
          Write-Host "ğŸ‘¤ User: $Username" -ForegroundColor White
          Write-Host "ğŸ”‘ Pass: $Password" -ForegroundColor White
          Write-Host "ğŸ–¥ï¸  Port: 3389" -ForegroundColor White

      - name: ğŸ§¹ Tá»I Æ¯U CUá»I
        run: |
          powercfg -change -standby-timeout-ac 0
          powercfg -change -monitor-timeout-ac 0
          powercfg -change -hibernate-timeout-ac 0
          Write-Host "âš¡ ÄÃ£ tá»‘i Æ°u xong" -ForegroundColor Green
