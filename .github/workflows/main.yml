name: ğŸš€ SEVER AI STV PREMIUM

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '12h'
        type: choice
        options:
          - '1h'
          - '3h'
          - '6h'
          - '12h'

jobs:
  Premium-RDP-Setup:
    runs-on: windows-2022
    timeout-minutes: 720

    steps:
      - name: ğŸ¯ KHá»I Äá»˜NG Há»† THá»NG
        run: |
          Write-Host ""
          Write-Host "ğŸ¤– AI STV PREMIUM RDP SERVER" -ForegroundColor Yellow
          Write-Host "âš¡ Powered by AI STV" -ForegroundColor Green
          Write-Host "ğŸ•’ Thá»i gian: ${{ github.event.inputs.duration }}" -ForegroundColor Magenta
          Write-Host ""

      - name: ğŸ›‘ Táº®T WINDOWS SECURITY (ANTI VIRUS + FIREWALL)
        run: |
          Write-Host "ğŸ›‘ Äang táº¯t Windows Defender & Firewall" -ForegroundColor Yellow

          # Táº¯t Tamper Protection (registry)
          reg add "HKLM\SOFTWARE\Microsoft\Windows Defender\Features" /v TamperProtection /t REG_DWORD /d 0 /f

          # Táº¯t realtime / behavior / cloud
          Set-MpPreference -DisableRealtimeMonitoring $true
          Set-MpPreference -DisableBehaviorMonitoring $true
          Set-MpPreference -DisableBlockAtFirstSeen $true
          Set-MpPreference -DisableIOAVProtection $true
          Set-MpPreference -DisableScriptScanning $true

          # Táº¯t SmartScreen
          reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer" /v SmartScreenEnabled /t REG_SZ /d Off /f
          reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v EnableSmartScreen /t REG_DWORD /d 0 /f

          # Táº¯t App & Browser Control
          reg add "HKLM\SOFTWARE\Microsoft\Windows Defender\SmartScreen" /v ConfigureAppInstallControlEnabled /t REG_DWORD /d 0 /f

          # Táº¯t Firewall
          netsh advfirewall set allprofiles state off

          Write-Host "âœ… ÄÃ£ táº¯t toÃ n bá»™ Windows Security" -ForegroundColor Green

      - name: ğŸ”§ Cáº¤U HÃŒNH RDP
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
          netsh advfirewall firewall add rule name="RDP-Premium-In" dir=in action=allow protocol=TCP localport=3389
          netsh advfirewall firewall add rule name="RDP-Premium-Out" dir=out action=allow protocol=TCP localport=3389
          Set-Service -Name TermService -StartupType Automatic
          Start-Service -Name TermService

      - name: ğŸ‘¤ Táº O TÃ€I KHOáº¢N PREMIUM
        run: |
          Write-Host ""
          Write-Host "ğŸ‘¤ ÄANG Táº O TÃ€I KHOáº¢N PREMIUM" -ForegroundColor Yellow

          $Username = "Premium"
          $Password = "AnhKhoa@123"

          $user = Get-LocalUser -Name $Username -ErrorAction SilentlyContinue
          if (-not $user) {
            net user $Username $Password /add /y
          } else {
            net user $Username $Password
          }

          net localgroup administrators $Username /add | Out-Null
          net localgroup "Remote Desktop Users" $Username /add | Out-Null

          Write-Host ""
          Write-Host "ğŸ” THÃ”NG TIN RDP"
          Write-Host "ğŸ‘¤ User: $Username"
          Write-Host "ğŸ”‘ Pass: $Password"
          Write-Host "ğŸ–¥ï¸  Port: 3389"

      - name: ğŸ§¹ Tá»I Æ¯U CUá»I
        run: |
          powercfg -change -standby-timeout-ac 0
          powercfg -change -monitor-timeout-ac 0
          powercfg -change -hibernate-timeout-ac 0
